<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Squid Game Doll Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #viewer {
      width: 25%;
      height: 100%;
      background: #111;
    }
    #game-area {
      width: 75%;
      height: 100%;
      background: #222;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="viewer"></div>
  <div id="game-area">
    Game Area (75%)
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/controls/OrbitControls.js';

    let scene, camera, renderer, controls;
    let doll, dollHead;

    init();
    animate();

    function init() {
      const container = document.getElementById('viewer');

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x111111);

      camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 1.5, 3);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.enableZoom = false;
      controls.target.set(0, 1.2, 0);

      const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
      light.position.set(0, 20, 0);
      scene.add(light);

      const loader = new GLTFLoader();
      loader.load('./doll.glb', function (gltf) {
        doll = gltf.scene;
        doll.scale.set(1.2, 1.2, 1.2);
        scene.add(doll);

        // Try to find "head" part in model
        doll.traverse((child) => {
          if (child.name.toLowerCase().includes('head')) {
            dollHead = child;
            console.log('Doll head detected:', child.name);
          }
        });
      });

      window.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'r' && dollHead) {
          dollHead.rotation.y += Math.PI / 4;
        }
      });

      window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      });
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
